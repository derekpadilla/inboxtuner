# README

## Overview

This document provides an overview and usage details of three Python scripts: `exporter.py`, `extract_email_body.py`, and `token_counter.py`. The purpose of these scripts is to:

1. Extract emails from Gmail.
2. Clean and format the extracted emails.
3. Count the number of tokens in the cleaned data.

---

## 1. exporter.py

### Description:
This script authorizes access to a Gmail account and exports all sent emails into a `messages.jsonl` file. We take all sent email because they contain both a question from a user and a response, which is what we want for our completion model.

### Dependencies:
- `jsonlines`
- `os`
- `json`
- `google.oauth2.credentials`
- `googleapiclient.discovery`
- `google_auth_oauthlib.flow`

### Usage:
1. You must have a `atoken.json` file containing your OAuth 2.0 client credentials. See Gmail OAuth instructions below.
2. Run the script.
3. If you're running it for the first time, it will open a browser window prompting you to log in to your Google account and grant the script access.
4. Emails are then fetched and stored in `messages.jsonl`.

## Setting up OAuth 2.0 for Gmail Workspace Inbox:

Instructions for obtaining an `atoken.json` file, which contains OAuth 2.0 client credentials:

1. **Google Cloud Console**:

   - Go to the Google Cloud Console (https://console.cloud.google.com/).

   - If you donâ€™t have a project, create a new one.

2. **Enable the Gmail API**:

   - In the Google Cloud Console, navigate to the "API & Services" > "Library".
   - Search for "Gmail API" and select it.
   - Click on the "ENABLE" button.

3. **Create OAuth 2.0 Credentials**:

   - In the Google Cloud Console, navigate to "API & Services" > "Credentials".
   - Click on the "CREATE CREDENTIALS" dropdown button and select "OAuth 2.0 Client IDs".
   - Select "Desktop App" as the application type (since the script uses a local server to capture the authentication token).
   - Click "CREATE".

4. **Download the Credentials**:

   - After the OAuth 2.0 Client IDs are created, you'll see a section named "Your Client IDs".
   - On the right side, click the download icon (which looks like a downward-facing arrow). This will download a JSON file.
   - Rename this file to `atoken.json`.

5. **Place the `atoken.json` File**:

   - Ensure `atoken.json` is in the same directory as the `exporter.py` script.

6. **Set Up OAuth 2.0 Consent Screen**:

   - Still in the Google Cloud Console, under "API & Services", navigate to the "OAuth consent screen" tab.
   - Fill in the required fields. This screen dictates what information the user sees when they are prompted to give consent.
   - Save your changes.

7. **Run the Script**:

   - Now, when you run the `exporter.py` script for the first time, it will open a browser window prompting you to log in to your Google account and grant access. Follow the on-screen instructions to complete the authentication.

---

## 2. extract_email_body.py

### Description:
This script reads from the `messages.jsonl` file generated by `exporter.py`. It extracts the body of the email, decodes any base64 encoded data, and processes hyperlinks, email addresses, and other special characters. The cleaned and formatted data is saved to `output.jsonl`.

### Dependencies:
- `json`
- `base64`
- `re`
- `bs4` (BeautifulSoup)

### Usage:
1. Ensure you have the `messages.jsonl` file in the same directory as this script.
2. Run the script.
3. Check `output.jsonl` for the processed email content.

---

## 3. token_counter.py

### Description:
This script calculates the number of tokens (words) present in a given JSONL file. It is currently set to read from `output.jsonl` by default.

### Dependencies:
- `nltk`

### Usage:
1. If you wish to count tokens from a different file, modify the `filename` variable in the script.
2. Run the script.
3. The script will display the number of tokens found in the specified file.

---

## General Notes:
- Ensure that you have all required libraries installed. You can typically install these using `pip install <library-name>`.
- Make sure to handle any sensitive information (like OAuth tokens) with care and avoid committing them to public repositories.
- Before deploying these scripts in a production environment, ensure you have tested them thoroughly, and always ensure you have the necessary permissions to access and manipulate email data.
- During the OAuth 2.0 consent flow, users might receive a warning that the app isn't verified by Google. This is normal for apps that are in development and not meant for wider distribution. If you're using this just for personal use or within a small organization, you can continue with the authentication. For larger deployments or public-facing apps, consider going through Google's verification process (https://support.google.com/cloud/answer/7454865).
- Ensure you handle the `atoken.json` with care. It contains sensitive credentials. Avoid committing it to public repositories or sharing it recklessly.
- If you ever believe that your OAuth 2.0 credentials have been compromised, you should revoke them immediately in the Google Cloud Console and create new ones.